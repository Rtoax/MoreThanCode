ptrace 介绍

作者 rtoax
日期 2020年12月21日

# 1. 调试断点
--------------------------------------------------------------
	80386 可支持同时设置四个断点条件，编程人员可在程序中的 4 
	个位置设置条件，使其转向异常处理程序。这四个断点的每个断点，
	都可以是如下三种不同类型的任何一种：
	 1)只在指令地址与断点地址一致时，断点有效
	 2)数据写入地址与断点地址一致时，断点有效
	 3)数据读出地址或数据写入地址与断点地址一致时，断掉有效


# 2. 调试寄存器
--------------------------------------------------------------
    x86 提供的8个调试寄存器(DR0-DR7)

    DR0-DR3: 存放断点地址寄存器
    DR4,DR5: 保留寄存器，不使用
    DR6:     状态寄存器
    ----------------------------------------------------------
		DR6寄存器各位的功能
		Bits[3:0]	当断点线性地址寄存器规定的条件被检测到时，将对应的
					Bits[3:0] 位 置 1. 置位Bits[3:0]与断点条件是否被
					启用无关。即Bits[3:0]的某位被置 1，并不表示要进行
					对应的断点异常处理。
					
		BD	如下一条指令要对 8 个调试寄存器之一进行读写时，在指令的边界BD
			位置被置 1.在一条指令内，每当即将读写调试寄存器时，也 BD 位置 1.
			BD 位置 1 与 DR7 中 GD 位启用与否 无关。

		BS	如果单步异常发生时，BS位被置1.  单步条件由 EFLAGS 寄存器中的 TF 位启用。
			如果程序由于单步条件进入调试处理程序， 则 BS 位置  1. 与 DR6 中的其他
			位不同的是，BS 位只在单步陷阱实际发生时才置位，而不是 检测到单步条件
			就置位。

		BT	BT 位对任务切换导致 TSS 中的调试陷阱位被启用而造成的调试异常，指示其原因。
			对这一条件，在 DR7 中没有启用位。

		DR6 中的各个标志位，在处理机的各种起初操作中不收影响，因此，调试异常处理程序
			在运行以前，应清楚 DR6 ，以免下一次检测到异常条件时，收到原来的 DR6 
			中状态为的影响。
			
    

    DR7:     控制寄存器，标志位如下：
    ----------------------------------------------------------
                                         | Type | Length |
                                         |              /
                                         |             /
                                         |            /
                                         |           /
                                         |          /
                                         |         /
                                         |        /
                                         |       /
                                         |      /
                                         |     |
                                          16 18 20 22 24 26 28 30
         0 1 2 3 4 5 6 7       8-15       17 19 21 23 25 27 29 31
        |L|G|L|G|L|G|L|G|                |T |L |T |L |T |L |T |L |
        +--------------------------------------------------------+
        |D|D|D|D|D|D|D|D|               |D |D |D |D |D |D |D |D |
        |R|R|R|R|R|R|R|R|                |R |R |R |R |R |R |R |R |
        |0|0|1|1|2|2|3|3|                |0 |0 |1 |1 |2 |2 |3 |3 |
             是否激活                       Type: 断点类型 (00 execute, 01 write, 11 read-write)
                                        Length: 断点长度 (00 1-byte, 01 2-bytes, 11 4-bytes)

# 3. 断点地址识别
--------------------------------------------------------------



